<!-- cloudDwellingé¡µé¢ - ç”¨æˆ·ä¸»é¡µ -->
<view class="cloud-dwelling-container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-profile-section">
    <view class="user-info">
      <view class="avatar-container">
        <block wx:if="{{avatarUrl}}">
          <image class="user-avatar-image" src="{{avatarUrl}}" mode="aspectFill"></image>
        </block>
        <view class="user-avatar" wx:else style="background: {{randomAvatarBg}}">èˆŸ</view>
      </view>
      <view class="user-details">
        <view class="username-container">
          <!-- æ ¹æ®ç™»å½•çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹ -->
          <block wx:if="{{isLoggedIn}}">
            <view class="username">{{username}}</view>
            <!-- ç™»å½•çŠ¶æ€ä¸‹æ ‘æœ¨å±•ç¤ºåœ¨ç”¨æˆ·åå³ä¾§ -->
            <view class="tree-count-container login-state">
              <text class="tree-count-total">ğŸŒ³ {{treeCount}}æ£µ</text>
            </view>
          </block>
          <block wx:else>
            <view class="username not-logged">æœªç™»å½•</view>
            <!-- ä¸€é”®ç™»å½•æŒ‰é’® -->
            <button class="login-button-inline" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
              ä¸€é”®ç™»å½•
            </button>
            <!-- æœªç™»å½•çŠ¶æ€ä¸‹æ ‘æœ¨å±•ç¤ºåœ¨ç™»å½•æŒ‰é’®å³ä¾§ -->
            <view class="tree-count-container">
              <text class="tree-count-total">ğŸŒ³ {{treeCount}}æ£µ</text>
            </view>
          </block>
        </view>
        <view class="tree-details-row">
          <text class="tree-source">ç«ç­”:{{lantingTrees}}</text>
          <text class="tree-source">æ¼«æ¸¸:{{timeSequenceTrees}}</text>
          <text class="tree-source">å·²ç”¨:{{consumedTrees}}</text>
        </view>
        <!-- ç”¨æˆ·ç¼–å·æ˜¾ç¤ºåœ¨æ ‘è‹—æ•°é‡ä¸‹æ–¹ -->
        <view class="user-id" wx:if="{{userId && isLoggedIn}}" bindtap="copyUserId">
          <text class="user-id-text">ID: {{userId}}</text>
        </view>
      </view>
    </view>
    
    <!-- ä¼šå‘˜ä¿¡æ¯åŒºåŸŸ -->
    <view class="member-info">
      <view class="member-status">
        <block wx:if="{{isVIP}}">
          <view class="member-badge vip">
            <text class="member-text">ä¼šå‘˜ä¿¡æ¯</text>
          </view>
          <view class="member-expire">
            <text class="expire-date">åˆ°æœŸæ—¶é—´ {{memberExpireTime}}</text>
          </view>
        </block>
        <block wx:else>
          <view class="member-badge normal">
            <text class="member-text">æœªå¼€é€š</text>
          </view>
          <view class="member-action">
            <text class="upgrade-hint">å¼€é€šä¼šå‘˜äº«æ›´å¤šæƒç›Š</text>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·æ“ä½œæŒ‰é’®åŒºåŸŸ -->
  <view class="user-actions-section">
    <view class="user-actions">
      <!-- è®¾ç½®æŒ‰é’® -->
      <view class="settings-button" bindtap="openSettings">
        <text>è®¾ç½®ä¿¡æ¯</text>
      </view>
      
      <!-- å°æ ‘è§„åˆ™æŒ‰é’® -->
      <view class="tree-rules-button" bindtap="showTreeRules">
        <text>å°æ ‘è§„åˆ™</text>
      </view>
      
      <!-- å°æ ‘å…‘æ¢æŒ‰é’® -->
      <view class="tree-exchange-button" bindtap="showTreeExchangeDialog">
        <text>å°æ ‘å…‘æ¢</text>
      </view>
      
      <!-- ä¼šå‘˜æŒ‰é’® -->
      <view class="membership-button" bindtap="upgradeMembership">
        <text>å¼€é€šä¼šå‘˜</text>
      </view>
    </view>
  </view>

  <!-- æ—¶èŠ‚å±•ç¤ºåŒºåŸŸ -->
  <view class="season-display-section">
    <view class="section-title">
      <text>å½“å‰æ—¶èŠ‚</text>
    </view>
    
    <view class="current-season">
      <view class="season-image-container">
        <image class="season-image" src="{{currentSeason.imageUrl || '../../images/placeholder-a4.svg'}}" mode="aspectFill"></image>
      </view>
      <view class="season-info">
        <view class="season-header">
          <view class="season-name-date">
            <text class="season-name">{{currentSeason.name}}</text>
            <text class="season-date">{{currentSeason.date}}</text>
          </view>
          <view class="season-countdown" wx:if="{{!isExactlyOnSolarTerm}}">
            <text>ä»Šå¤©æ˜¯{{currentSeason.currentMonth}}æœˆ{{currentSeason.currentDay}}æ—¥ï¼Œè·ç¦»{{nextSeasonName}}è¿˜æœ‰{{daysToNextSeason}}å¤©</text>
          </view>
        </view>
        <view class="season-description">{{currentSeason.description}}</view>
      </view>
    </view>
    
    <view class="season-quote">
      <text>"{{currentSeason.quote}}"</text>
    </view>
  </view>

  <!-- æ—¶èŠ‚æ¢ç´¢åŒºåŸŸ -->
  <view class="exploration-section">
    <view class="section-title">
      <text>æ—¶èŠ‚æ¢ç´¢</text>
    </view>
    
    <view class="exploration-cards">
      <!-- æ—¶åŸåšè§ˆ (å…³è” greenCliff é¡µé¢) -->
      <view class="exploration-card" bindtap="navigateTo" data-page="greenCliff">
        <view class="card-icon">ğŸï¸</view>
        <view class="card-content">
          <view class="card-title">æ—¶åŸåšè§ˆ</view>
          <view class="card-description">åšè§ˆæ—¶åŸå²æœˆè¿¹ï¼Œæ¢å¯»èŠ‚ä»¤å¾€æ¥è¸ª</view>
        </view>
      </view>
      
      <!-- æ—¶åŸæ¼«æ¸¸ (å…³è” timeSequence é¡µé¢) -->
      <view class="exploration-card" bindtap="navigateTo" data-page="timeSequence">
        <view class="card-icon">ğŸƒ</view>
        <view class="card-content">
          <view class="card-title">æ—¶åŸæ¼«æ¸¸</view>
          <view class="card-description">æ¯æ—¥ä¸€åŸå¯»æ•…äº‹ï¼Œåº”æ—¶åº”æ™¯æ¸¸å››æ–¹</view>
        </view>
      </view>
      
      <!-- æ—¶åŸç«ç­” (å…³è” lanTing é¡µé¢) -->
      <view class="exploration-card" bindtap="navigateTo" data-page="lanTing">
        <view class="card-icon">ğŸ“œ</view>
        <view class="card-content">
          <view class="card-title">æ—¶åŸç«ç­”</view>
          <view class="card-description">æ¼«æ­¥æ¥¼å°çƒŸé›¨ä¸­ï¼Œç»†å“å¥½é›¨çŸ¥æ—¶èŠ‚</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å‹‹ç« å±•ç¤ºåŒºåŸŸ -->
  <view class="badge-section">
    <view class="section-title">
      <text>æˆ‘çš„å‹‹ç« </text>
    </view>
    <view class="badge-container">
      <block wx:if="{{badges && badges.length > 0}}">
        <scroll-view scroll-x class="badge-scroll">
          <view class="badge-list">
            <view class="badge-card" wx:for="{{badges}}" wx:key="badgeId" bindtap="showBadgeDetail" data-badge="{{item}}" style="background: {{item.bgColor}}">
              <image class="badge-icon" src="{{item.iconUrl}}" mode="aspectFit"></image>
              <view class="badge-name">{{item.name}}</view>
            </view>
          </view>
        </scroll-view>
        <view class="badges-more" bindtap="viewAllBadges">å…±{{badgeCount}}æšï¼ŒæŸ¥çœ‹å…¨éƒ¨</view>
      </block>
      <view class="empty-badges" wx:else>
        <view class="empty-icon">ğŸ…</view>
        <view class="empty-text">æš‚æ— å‹‹ç« </view>
        <view class="empty-action" bindtap="navigateTo" data-page="timeSequence">å»æ¼«æ¸¸åŸå¸‚è·å–</view>
      </view>
    </view>
  </view>
  <view class="badge-detail-modal" wx:if="{{showBadgeDetail}}">
    <view class="badge-detail-content">
      <view class="badge-detail-header">
        <view class="badge-detail-title">{{selectedBadge.name}}</view>
        <view class="badge-detail-close" bindtap="hideBadgeDetail">Ã—</view>
      </view>
      <image class="badge-detail-icon" src="{{selectedBadge.iconUrl}}" mode="aspectFit"></image>
      <view class="badge-detail-desc">{{selectedBadge.description}}</view>
      <view class="badge-detail-date">é¢†å–æ—¥æœŸï¼š{{selectedBadge.obtainedAtFormatted}}</view>
    </view>
  </view>

  <!-- è¶³è¿¹åˆ—è¡¨åŒºåŸŸ -->
  <view class="footprints-section">
    <view class="section-title">
      <text>æˆ‘çš„è¶³è¿¹</text>
    </view>
    
    <view class="footprints-container">
      <block wx:if="{{footprints && footprints.length > 0}}">
        <scroll-view scroll-x class="footprints-scroll">
          <view class="footprints-list">
            <view class="footprint-card" wx:for="{{footprints}}" wx:key="timestamp" bindtap="viewFootprintCity" data-city="{{item}}">
              <view class="footprint-icon">ğŸ‘£</view>
              <view class="footprint-info">
                <view class="footprint-city">{{item.cityName}}</view>
                <view class="footprint-date">{{item.date}}</view>
              </view>
            </view>
          </view>
        </scroll-view>
        <view class="footprints-more" bindtap="viewAllFootprints">æŸ¥çœ‹å…¨éƒ¨</view>
      </block>
      <view class="empty-footprints" wx:else>
        <view class="empty-icon">ğŸ—ºï¸</view>
        <view class="empty-text">æ‚¨è¿˜æ²¡æœ‰ç•™ä¸‹è¶³è¿¹</view>
        <view class="empty-action" bindtap="navigateTo" data-page="timeSequence">å»åŸå¸‚æ¼«æ¸¸</view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·æ´»åŠ¨åŒºåŸŸ -->
  <view class="activity-section">
    <view class="section-title">
      <text>è¿‘æœŸæ´»åŠ¨</text>
    </view>
    
    <view class="activity-list">
      <block wx:if="{{activities && activities.length > 0}}">
        <view class="activity-item" wx:for="{{activities}}" wx:key="_id">
          <view class="activity-time">{{item.time}}</view>
          <view class="activity-content">
            <text class="activity-text">{{item.description}}</text>
            <view class="activity-reward" wx:if="{{item.reward}}">
              <text>+ {{item.reward}} ğŸŒ³</text>
            </view>
          </view>
        </view>
      </block>
      <view class="empty-activities" wx:else>
        <view class="empty-icon">ğŸ“</view>
        <view class="empty-text">æš‚æ— æ´»åŠ¨è®°å½•</view>
      </view>
    </view>
  </view>

  <!-- ç³»ç»Ÿè®¾ç½®åŒºåŸŸ -->
  <view class="settings-section">
    <view class="section-title">
      <text>ç³»ç»Ÿè®¾ç½®</text>
    </view>
    
    <view class="settings-list">
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="about">
        <view class="settings-icon">ğŸ“–</view>
        <view class="settings-content">
          <text class="settings-text">å…³äºæˆ‘ä»¬</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="userAgreement">
        <view class="settings-icon">ğŸ“</view>
        <view class="settings-content">
          <text class="settings-text">ç”¨æˆ·åè®®</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="privacyPolicy">
        <view class="settings-icon">ğŸ”’</view>
        <view class="settings-content">
          <text class="settings-text">éšç§æ”¿ç­–</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
      
      <view class="settings-item" bindtap="navigateToSystemPage" data-page="contactUs">
        <view class="settings-icon">ğŸ“</view>
        <view class="settings-content">
          <text class="settings-text">è”ç³»å®¢æœ</text>
        </view>
        <view class="settings-arrow">></view>
      </view>

      <view class="settings-item" bindtap="logout" wx:if="{{isLoggedIn}}">
        <view class="settings-icon">ğŸšª</view>
        <view class="settings-content">
          <text class="settings-text">é€€å‡ºç™»å½•</text>
        </view>
        <view class="settings-arrow">></view>
      </view>
    </view>
    
    <view class="app-version">
      <text>å°èˆŸæ‘‡é£æºª v1.0.0</text>
    </view>
  </view>

  <!-- å…³äºæˆ‘ä»¬å¼¹çª— -->
  <view class="about-dialog-mask" wx:if="{{showAboutDialog}}" bindtap="closeAboutDialog">
    <view class="about-dialog" catchtap="catchDialogTap">
      <view class="about-dialog-header">
        <view class="about-dialog-title">å…³äºæˆ‘ä»¬</view>
        <view class="about-dialog-close" bindtap="closeAboutDialog">Ã—</view>
      </view>
      <view class="about-dialog-content">
        <view class="about-app-name">{{aboutInfo.name}} <text class="about-app-version">{{aboutInfo.version}}</text></view>
        <view class="about-app-desc">{{aboutInfo.description}}</view>
        <view class="about-app-contact" bindtap="copyEmail">
          <text class="contact-label">è”ç³»é‚®ç®±: </text>
          <text class="contact-value">{{aboutInfo.email}}</text>
        </view>
        <view class="about-app-copyright">{{aboutInfo.copyright}}</view>
      </view>
    </view>
  </view>

  <!-- å°æ ‘è§„åˆ™å¼¹çª— -->
  <view class="tree-rules-dialog-mask" wx:if="{{showTreeRulesDialog}}" bindtap="closeTreeRulesDialog">
    <view class="tree-rules-dialog" catchtap="catchDialogTap">
      <view class="tree-rules-dialog-header">
        <view class="tree-rules-dialog-title">å°æ ‘è§„åˆ™</view>
        <view class="tree-rules-dialog-close" bindtap="closeTreeRulesDialog">Ã—</view>
      </view>
      <view class="tree-rules-dialog-content">
        <view class="tree-rules-text">
          <view class="rule-item">å»é˜…è¯»å’ŒæŒ‘æˆ˜å¯ä»¥ç§¯ç´¯å°æ ‘æ•°é‡å“¦ï¼</view>
          <view class="rule-item">æ¶ˆè€—500é¢—å¯ä»¥æ¢1å¤©ä¼šå‘˜</view>
          <view class="rule-item">æ¶ˆè€—1000é¢—å¯ä»¥æ¢3å¤©ä¼šå‘˜</view>
          <view class="rule-item">æ¶ˆè€—2000é¢—å¯ä»¥æ¢7å¤©ä¼šå‘˜</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å°æ ‘å…‘æ¢å¼¹çª— -->
  <view class="tree-exchange-dialog-mask" wx:if="{{showTreeExchangeDialog}}" bindtap="closeTreeExchangeDialog">
    <view class="tree-exchange-dialog" catchtap="catchDialogTap">
      <view class="tree-exchange-dialog-header">
        <view class="tree-exchange-dialog-title">å°æ ‘å…‘æ¢ä¼šå‘˜</view>
        <view class="tree-exchange-dialog-close" bindtap="closeTreeExchangeDialog">Ã—</view>
      </view>
      <view class="tree-exchange-dialog-content">
        <view class="current-trees">
          <text class="trees-label">å½“å‰å°æ ‘ï¼š</text>
          <text class="trees-count">ğŸŒ³ {{treeCount}}æ£µ</text>
        </view>
        
        <view class="exchange-options">
          <view class="exchange-option" bindtap="exchangeMembership" data-days="1" data-cost="500">
            <view class="option-info">
              <view class="option-title">1å¤©ä¼šå‘˜</view>
              <view class="option-cost">æ¶ˆè€— 500 ğŸŒ³</view>
            </view>
            <view class="option-status {{treeCount >= 500 ? 'available' : 'unavailable'}}">
              {{treeCount >= 500 ? 'å¯å…‘æ¢' : 'å°æ ‘ä¸è¶³'}}
            </view>
          </view>
          
          <view class="exchange-option" bindtap="exchangeMembership" data-days="3" data-cost="1000">
            <view class="option-info">
              <view class="option-title">3å¤©ä¼šå‘˜</view>
              <view class="option-cost">æ¶ˆè€— 1000 ğŸŒ³</view>
            </view>
            <view class="option-status {{treeCount >= 1000 ? 'available' : 'unavailable'}}">
              {{treeCount >= 1000 ? 'å¯å…‘æ¢' : 'å°æ ‘ä¸è¶³'}}
            </view>
          </view>
          
          <view class="exchange-option" bindtap="exchangeMembership" data-days="7" data-cost="2000">
            <view class="option-info">
              <view class="option-title">7å¤©ä¼šå‘˜</view>
              <view class="option-cost">æ¶ˆè€— 2000 ğŸŒ³</view>
            </view>
            <view class="option-status {{treeCount >= 2000 ? 'available' : 'unavailable'}}">
              {{treeCount >= 2000 ? 'å¯å…‘æ¢' : 'å°æ ‘ä¸è¶³'}}
            </view>
          </view>
        </view>
        
        <view class="exchange-tips">
          <text>ğŸ’¡ å°è´´å£«ï¼šé€šè¿‡æ—¶åŸç«ç­”å’Œæ—¶åŸæ¼«æ¸¸å¯ä»¥è·å¾—æ›´å¤šå°æ ‘å“¦ï¼</text>
        </view>
      </view>
    </view>
  </view>
  <canvas canvas-id="compressCanvas" style="position: fixed; top: -9999px; left: -9999px; width: 750px; height: 1334px;"></canvas>
</view>
